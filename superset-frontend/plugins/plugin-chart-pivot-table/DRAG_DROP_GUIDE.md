# Pivot Table Drag and Drop Configuration Guide

## Overview

The Pivot Table plugin now supports drag-and-drop functionality for reordering columns using native HTML5 Drag and Drop API. This feature allows users to interactively rearrange columns by dragging column headers.

## Configuration

### Standard Pivot Table

For standard pivot tables, drag-and-drop is configured through a JSON string:

```json
{
  "enabled": true,
  "columnsDragEnabled": true,
  "rowsDragEnabled": true
}
```

### Header Tree Pivot Table (2-levels)

When using Header (2 levels) JSON, the drag-and-drop works differently:

1. **Enable drag-and-drop** in "Drag and Drop Configuration"
2. **Column swaps** are stored in "Columns Index Swaps" field as JSON array of [from, to] pairs

Example Header Tree configuration:
```json
{
  "groups": [
    {
      "title": "Начальные запасы", 
      "subgroups": [
        {
          "title": "Свободный газ",
          "segments": [
            { "title": "Геологические", "count": 1 },
            { "title": "Извлекаемые", "count": 1 }
          ]
        }
      ]
    }
  ]
}
```

Column swaps (automatically generated by drag-and-drop):
```json
[[0, 2], [1, 3]]
```
This swaps column 0 with 2, and column 1 with 3.

### Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `enabled` | boolean | `false` | Master switch to enable/disable drag-and-drop functionality |
| `columnsDragEnabled` | boolean | `true` | Enable/disable dragging of column headers |
| `rowsDragEnabled` | boolean | `true` | Enable/disable dragging of row headers (future feature) |

### How to Enable

1. Open your Pivot Table chart in edit mode
2. Go to the "Drag and Drop Configuration" control in the Options section
3. Enter your JSON configuration:

**To enable column drag-and-drop:**
```json
{
  "enabled": true,
  "columnsDragEnabled": true
}
```

**To disable drag-and-drop:**
```json
{
  "enabled": false
}
```

## Usage

### Dragging Columns

1. Ensure drag-and-drop is enabled in your configuration
2. Hover over a column header - the cursor will change to a "move" cursor
3. Click and drag the column header to a new position
4. Release to drop the column in the new location

### Visual Feedback

- **Draggable columns**: Show a "move" cursor on hover
- **During drag**: The dragged column becomes semi-transparent (opacity: 0.5)
- **Background colors**: Provide visual feedback during hover and drag states

### Validation

The JSON configuration includes built-in validation:
- Must be valid JSON format
- Boolean values are enforced for all options
- Invalid configurations will show error messages

## Implementation Details

### Technical Components

1. **Types** (`types.ts`): Added interfaces for drag-and-drop configuration and handlers
2. **TableRenderers** (`TableRenderers.jsx`): Core drag-and-drop logic using HTML5 API
3. **PivotTableChart** (`PivotTableChart.tsx`): Integration layer for callbacks
4. **Control Panel** (`controlPanel.tsx`): Configuration UI with validation
5. **Transform Props** (`transformProps.ts`): Props transformation
6. **Styles** (`Styles.js`): CSS for visual feedback

### HTML5 Drag and Drop Events

- `onDragStart`: Initialize drag operation, set drag data
- `onDragOver`: Allow dropping by preventing default behavior
- `onDrop`: Handle the drop operation, reorder columns
- `onDragEnd`: Clean up drag state

### State Management

The component maintains drag state:
```javascript
state = {
  draggedColumn: null,    // Index of currently dragged column
  columnOrder: null       // Current column order
}
```

## Browser Compatibility

This feature uses native HTML5 Drag and Drop API, which is supported in:
- Chrome 4+
- Firefox 3.5+
- Safari 3.1+
- Edge (all versions)
- Internet Explorer 9+

## Limitations

1. **Row dragging**: Currently only column dragging is implemented
2. **Mobile support**: HTML5 Drag and Drop has limited mobile touch support
3. **Nested headers**: Complex nested headers may have limitations

## Troubleshooting

### Common Issues

1. **Drag not working**: Ensure `enabled: true` and `columnsDragEnabled: true`
2. **JSON errors**: Validate JSON syntax using a JSON validator
3. **No visual feedback**: Check browser console for JavaScript errors

### Example Valid Configurations

**Minimal configuration:**
```json
{"enabled": true}
```

**Full configuration:**
```json
{
  "enabled": true,
  "columnsDragEnabled": true,
  "rowsDragEnabled": false
}
```

**Disabled:**
```json
{"enabled": false}
```

## Future Enhancements

- Row header drag-and-drop
- Touch/mobile support
- Drag-and-drop between different sections
- Advanced drag constraints and rules
- Keyboard accessibility for drag-and-drop