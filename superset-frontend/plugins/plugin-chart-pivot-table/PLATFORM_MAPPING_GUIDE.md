# Platform to Header Mapping Guide

## Проблема

У вас есть pivot table с данными:
```
platform | rank | count | 321 | 222 | 123
PS2      | 7812 | 1     | 1   | 1   | 1
Wii      | 4923 | 1     | 1   | 1   | 1
PS       | 13994| 1     | 1   | 1   | 1
DS       | 14194| 1     | 1   | 1   | 1
...
```

Сейчас каждая platform отображается под каждой метрикой, но вы хотите распределить platforms по разным заголовкам, например:
- PS2 → под заголовком "Свободный газ → Геологические"
- DS → под заголовком "Свободный газ → Извлекаемые"

## Решение: Platform to Header Mapping

### 1. Настройка Header Tree JSON

Сначала настройте многоуровневую шапку:

```json
{
  "groups": [
    {
      "title": "Свободный газ",
      "subgroups": [
        {
          "title": "Геологические",
          "count": 3
        },
        {
          "title": "Извлекаемые", 
          "count": 3
        }
      ]
    }
  ]
}
```

### 2. Настройка Platform Mapping

В поле "Platform to Header Mapping" введите JSON:

```json
{
  "PS2": {
    "level1": "Свободный газ",
    "level2": "Геологические"
  },
  "DS": {
    "level1": "Свободный газ", 
    "level2": "Извлекаемые"
  },
  "Wii": {
    "level1": "Свободный газ",
    "level2": "Геологические"
  },
  "PS": {
    "level1": "Свободный газ",
    "level2": "Извлекаемые"
  }
}
```

### 3. Результат

После применения mapping:
- Данные для PS2 и Wii будут отображаться под заголовком "Свободный газ → Геологические"
- Данные для DS и PS будут отображаться под заголовком "Свободный газ → Извлекаемые"
- Platforms без mapping останутся в исходных позициях

## Отладка

1. Откройте Developer Tools (F12)
2. В консоли найдите сообщения:
   - `HeaderTreePivotChart ▶ inputs` - показывает входные данные
   - `platform mapping match` - показывает когда срабатывает mapping
   - `Column Groups Info` - показывает итоговую структуру групп

## Синтаксис Platform Mapping

```json
{
  "значение_платформы": {
    "level1": "название_группы_1_уровня",
    "level2": "название_подгруппы_2_уровня", 
    "level3": "название_сегмента_3_уровня" // опционально
  }
}
```

### Примеры:

**Простое mapping (2 уровня):**
```json
{
  "PS2": {"level1": "Консоли", "level2": "Sony"},
  "Xbox": {"level1": "Консоли", "level2": "Microsoft"}
}
```

**С сегментами (3 уровня):**
```json
{
  "PS2": {
    "level1": "Консоли", 
    "level2": "Sony",
    "level3": "Старые"
  },
  "PS5": {
    "level1": "Консоли",
    "level2": "Sony", 
    "level3": "Новые"
  }
}
```

## Важные замечания

1. **Точное совпадение**: Значения platforms должны точно совпадать с данными в таблице
2. **Регистр**: Учитывается регистр букв 
3. **Приоритет**: Platform Mapping применяется перед Relocate Rules
4. **Валидация**: Некорректный JSON будет проигнорирован
5. **Logs**: Все действия логируются в консоль браузера для отладки

## Альтернатива: Relocate Rules

Для более сложных сценариев можно использовать "Relocate rules":

```json
[
  {
    "when": {"platform": "PS2"}, 
    "set": {"__m0": "Свободный газ", "__m1": "Геологические"}
  },
  {
    "when": {"platform": "DS"},
    "set": {"__m0": "Свободный газ", "__m1": "Извлекаемые"}
  }
]
```

Platform Mapping - это упрощенная версия Relocate Rules для частого случая перемещения platforms.